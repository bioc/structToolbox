---
title: 'Example 1: Dataset and model objects'
output: rmarkdown::html_vignette
vignette: >
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
---

The dataset object is designed to hold information relevant for a dataset, such as the raw data, sample meta data and variable metadata. We will use Fisher's Iris dataset as an example.

```{r}
library('structToolbox')
X=iris
summary(X)
```

First, we create a dataset object to hold the data. This will make the data compatible with the rest of the struct package objects. Note that fields such as 'name' and 'description' can be set when the object is created.
```{r}
D=dataset(data=X[,1:4],
    sample_meta=X[,5,drop=FALSE],
    name='Iris data',
    description='The data used in Fisher\'s paper')
D
```

Alternatively fields can be set for the dataset object after object creation. Valid fields for dataset objects are *name*, *description*, *type*, *sample_meta*, *variable_meta* and *data*.
```{r}
name(D)='Fisher\'s Iris data'
D
```

Fields in the dataset object can be retrieved using `$` notation:
```{r}
# name stored in object D
name(D)
# summary of sample meta data for D
summary(D$sample_meta)
```

Model objects can be used to apply methods such as Principal Component Analysis to a dataset. First the object has to be created. Model objects are also used for preprocessing steps that need to be applied on a training/test set basis, such as Mean Centring.

```{r}
M=mean_centre()
M
```

Model objects have some fields in common with dataset object, such as 'name' and 'description' that can be accessed in the same way as for the dataset object.

```{r}
name(M)
```

Model objects also have 'param' and 'output' functions for getting/setting model specific parameters and outputs.

```{r}
# list the valid outputs from the mean centring object
output.ids(M)
```

Model objects can be trained using using dataset objects as input. For the mean_centre object this calculates the mean of each column and stores it in the 'mean' output.

```{r}
# train the model using the data in D
M=model.train(M,D)
output.value(M,'mean_data')
```

Model objects also have a 'predict' method that allows a trained model to be applied to e.g. test data if required. We don't have test data for this example, so we'll just use the training data. The mean centred data is returned as output 'centred'

```{r}
M=model.predict(M,D)
Dc=M$centred # a dataset object
# verify the data is column centred (colMeans should be 0, or very close)
colMeans(Dc$data)
```


Now that we have centred the data we can apply Principal Component Analysis (PCA). First we create the object. Note that we can create the object and set parameter values at the same time.

```{r}
P=PCA('number_components'=2)
```


The names of valid parameters for a model object can retrieved as a list.

```{r}
param.ids(P)
```

Parameter values can be set and retrieved using the 'param' function combined with the parameter name.
```{r}
# set the number of components to 5
param.value(P,'number_components')=5
# get the number of components
param.value(P,'number_components')
```

A list of all parameter - value pairs can be retrieved using the param.list function.
```{r}
L=param.list(P)
L
# change number of components to 4
L$number_components=4
param.list(P)=L
param.value(P,'number_components')
```

The PCA model object can be trained in the same way as the mean_centre object, but this time we will input the mean centred dataset object.

```{r, fig.height=5, fig.width=5}
P=model.train(P,Dc) # train using the Iris data object
```

Outputs can be accessed in a similar way to parameters.

```{r}
# valid outputs for PCA model
output.ids(P)
```
```{r}
# get the PCA scores
scores=output.value(P,'scores')
summary(scores)
```

The `chart.names` function can be sued to list charts for the input object, in this case a PCA object.

```{r, fig.height=5, fig.width=5}
chart.names(P)
```

Note Note that charts are objects in their own right within the `struct` framework. The `chart.plot` function can be used with a valid chart object to plot the chart.

```{r, fig.height=5, fig.width=5}
C=pca_scores_plot(groups=1) # chart object
chart.plot(C,P)
```

The default values for chart title, axis labels etc are used unless a list of options is included in the chart.plot function. Options for a specific chart can be obtained using the `params.list` function.

```{r, fig.height=5, fig.width=5}
# get options for the scores plot
opt=param.list(C)
# change the colouring to be related to the factor of interest
opt$factor_name='Species'
opt$groups=Dc$sample_meta$Species
opt$points_to_label='none'
param.list(C)=opt
# plot the chart with the new options
chart.plot(C,P)
```


